<!DOCTYPE html>
<html ng-app="ConfiguratorApp">
<head>
	<title></title>
	<meta charset="utf-8"> 
	<link rel="stylesheet" href="css/main.css">
	<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="js/angular.min.js"></script>
	<script type="text/javascript" src="js/configurator.js"></script>
	<script type="text/javascript" src="js/directives.js"></script>
	<script type="text/javascript" src="js/ngDraggable.js"></script>
</head>
<body>
	<div class="configurator" ng-controller="ConfiguratorCtrl">
		<!-- ПАНЕЛЬ ИНСТРУМЕНТОВ -->
		<div class="tools {{toStorage}}"
			 ng-drop="true"
			 ng-drop-success="onGarbageDropComplete($data, $event)">
			<div class = "title"><strong>Склад</strong></div>
			<ul>
				<li ng-repeat="tool in tools" ng-show="tool.count !== 0">
					<div class="title">{{tool.name}} <span ng-show="tool.count > 0">({{tool.count}})</span></div>
					<div class="tool-container {{tool.toolClass}}"
						 ng-drag="true"
						 ng-drag-data="tool"
						 ng-drag-success="onToolDragComplete($data, $event)"
						 ng-mousedown="onToolMouseDown(tool)"
						 ng-mouseup="onToolMouseUp(tool)">
						 <div>
							<div indicators
								 ng-repeat="(name, indicator) in tool.indicators"
								 tool-name="{{tool.name}}"
								 indicator-name="{{name}}"></div>
						 </div>
					</div>
					<div class="tool-container {{tool.toolClass}}" ng-show="tool.mouseOver && !itemOver">
						<div>
						<div indicators
							 ng-repeat="(name, indicator) in tool.indicators"
							 tool-name="{{tool.name}}"
							 indicator-name="{{name}}"></div>
						</div>
					</div>
				</li>
			</ul>
		</div>
		<!-- /ПАНЕЛЬ ИНСТРУМЕНТОВ -->

		<!-- ГЕНЕРАТОР АВТОМАТА -->
		<div class="machine" ng-show="mode == modes.machine">
			<div>
				<div class="machine-place-offset" ng-style="settings.machinePlaceOffset"></div>
				<div class="machine-place" ng-style="settings.machinePlace" ng-repeat="place in spiralPlaces"></div>
				<div class="machine-place-offset" ng-style="settings.machinePlaceOffset"></div>
			</div>
			<div class="hole"
				 ng-repeat="hole in holes"
				 ng-drop="true"
				 ng-drop-success="onHoleDropComplete($data, $event, hole)"
				 ng-class="{'not-empty': hole.shelf,
							'tool-mouse-over': tools.shelf.mouseOver && !hole.shelf}">
				<div class="circle left"></div>
				<div class="circle right"></div>
				<div class="hole-label">{{hole.id}}</div>
				<div class="configure-shelf" ng-show="hole.shelf">
					<button type="button" ng-click="configureShelf(hole.shelf)">Настроить</button>
				</div>
				<!-- ПОЛКА АВТОМАТА -->
				<div class="{{hole.shelf.objectClass}}"
					 ng-show="hole.shelf"
					 ng-drag="true"
					 ng-drag-data="hole.shelf"
					 ng-drag-success="onShelfDragComplete($data, $event, hole)"
					 ng-mousedown="onToolMouseDown(hole.shelf, $index)"
					 ng-mouseup="onToolMouseUp(hole.shelf, $index)">
					<!-- МОТОРЫ -->
					<div class="machine-items">
						<div class="machine-place-offset" ng-style="settings.machinePlaceOffset"></div>
						<div class="machine-place"
							 ng-style="settings.machinePlace"
							 ng-repeat="motorPlace in hole.shelf.motorPlaces">
							<div class="{{motorPlace.item.machineClass}}"
								 style="{{settings[motorPlace.item.machineClass]}}"></div>
						</div>
						<div class="machine-place-offset" ng-style="settings.machinePlaceOffset"></div>
					</div>
					<!-- /МОТОРЫ -->
					<!-- СПИРАЛИ -->
					<div class="machine-items">
						<div class="machine-place-offset" ng-style="settings.machinePlaceOffset"></div>
						<div class="machine-place"
							 ng-style="settings.machinePlace"
							 ng-repeat="spiralPlace in hole.shelf.spiralPlaces">
							<div class="{{spiralPlace.item.machineClass}}"
								 style="{{settings[spiralPlace.item.machineClass]}}">
								<div class="{{spiralPlace.item.ski.machineClass}}"
									 style="{{settings[spiralPlace.item.ski.machineClass]}}"></div>
							</div>
						</div>
						<div class="machine-place-offset" ng-style="settings.machinePlaceOffset"></div>
					</div>
					<!-- /СПИРАЛИ -->
				</div>
				<!-- /ПОЛКА АВТОМАТА -->
			</div>
		</div>
		<!-- /ГЕНЕРАТОР АВТОМАТА -->

		<!-- ГЕНЕРАТОР ПОЛКИ -->
		<div class="shelf-generator" ng-show="mode == modes.shelf">
			<div class="shelf-model" ng-style="settings.shelfModel">
				<div class="motor-place" ng-style="settings.motorPlace"></div>
				<div class="spiral-places" ng-style="settings.spiralPlaces">
					<div class="place-offset" ng-style="settings.placeOffset"></div>
					<div class="spiral-place"
						 ng-style="settings.spiralPlace"
						 ng-repeat="spiralPlace in currentShelf.spiralPlaces">
						<div class="spiral-hole"></div>
						<div class="rail" ng-style="settings.rail"></div>
					</div>
					<div class="place-offset" ng-style="settings.placeOffset"></div>
				</div>
				<div class="single-spiral-detectors" ng-style="settings.singleSpiralDetectors">
					<div class="place-offset" ng-style="settings.placeOffset"></div>
					<div class="single-spiral-detector {{spiralPlace.class}}"
						 ng-class="{'tool-mouse-over': currentTool.mouseOver}"
						 ng-style="settings.singleSpiralDetector"
						 ng-repeat="spiralPlace in currentShelf.spiralPlaces"
						 ng-drop="true"
						 ng-drop-success="onSpiralPlaceDropComplete($data, $event, $index)">
						<div class="{{spiralPlace.item.objectClass}}"
							 style="{{settings[spiralPlace.item.objectClass]}}"
							 ng-drag="true"
							 ng-drag-data="spiralPlace.item"
							 ng-drag-success="onItemDragComplete($data, $event, $index)"
							 ng-mousedown="onToolMouseDown(spiralPlace.item, $index)"
							 ng-mouseup="onToolMouseUp(spiralPlace.item, $index)">
							<div class="{{spiralPlace.item.ski.objectClass}}"
								 style="{{settings[spiralPlace.item.ski.objectClass]}}"></div>
							<div class="shelf-indicators">
								<div indicators
								 ng-repeat="(name, indicator) in spiralPlace.item.indicators"
								 tool-name="{{spiralPlace.item.name}}"
								 indicator-name="{{name}}"></div>
							</div>
						</div>
						<div class="detector-rail" ng-style="settings.rail"></div>
					</div>
					<div class="place-offset" ng-style="settings.placeOffset"></div>
				</div>
				<div class="motor-detectors">
					<div class="motor-offset" ng-style="settings.motorOffset"></div>
					<div class="motor-detector {{motorPlace.class}}"
						 ng-class="{'tool-mouse-over': currentTool.mouseOver}"
						 ng-style="settings.motorDetector"
						 ng-repeat="motorPlace in currentShelf.motorPlaces"
						 ng-drop="true"
						 ng-drop-success="onMotorPlaceDropComplete($data, $event, $index)">
						<div class="{{motorPlace.item.objectClass}}"
							 style="{{settings[motorPlace.item.objectClass]}}"
							 ng-drag="true"
							 ng-drag-data="motorPlace.item"
							 ng-drag-success="onItemDragComplete($data, $event, $index)"
							 ng-mousedown="onToolMouseDown(motorPlace.item, $index)"
							 ng-mouseup="onToolMouseUp(motorPlace.item, $index)">
							<div class="shelf-indicators">
								<div indicators
								 ng-repeat="(name, indicator) in motorPlace.item.indicators"
								 tool-name="{{motorPlace.item.name}}"
								 indicator-name="{{name}}">
								</div>
							</div>
						</div>
					</div>
					<div class="motor-offset"></div>
				</div>
				<div class="price-detectors"
					 ng-style="settings.priceDetectors">
					<div ng-repeat="labelIdx in getTimes(labelsLinesCount)" class="price-container">
						<div class="machine-place-offset" ng-style="settings.machinePlaceOffset"></div>
						<div ng-repeat="pricePlace in currentShelf.pricePlaces.slice(labelIdx * placesOnShelf, (labelIdx + 1) * placesOnShelf)"
							 class="price-detector {{pricePlace.class}}"
							 ng-style="settings.priceDetector"
							 ng-drop="true"
							 ng-drop-success="onPricePlaceDropComplete($data, $event, $index + labelIdx * placesOnShelf)">
							<div ng-show="pricePlace.item" class="{{pricePlace.item.objectClass}}"
								 style="{{settings[pricePlace.item.objectClass]}}"
								 ng-drag="true"
								 ng-drag-data="pricePlace.item"
								 ng-drag-success="onItemDragComplete($data, $event, $index + labelIdx * placesOnShelf)"
								 ng-mousedown="onToolMouseDown(pricePlace.item, $index)"
								 ng-mouseup="onToolMouseUp(pricePlace.item, $index)">
								<input class="price-text"
									   style="{{settings['price-text']}}"
									   type="text"
									   ng-model="pricePlace.item.value"
									   ng-mousedown="preventDrag($event)">
							</div>
						</div>
						<div class="machine-place-offset" ng-style="settings.machinePlaceOffset"></div>
					</div>
				</div>
			</div>
			<div class="to-machine">
				<button type="button" ng-click="configureMachine()">К автомату</button>
			</div>
		</div>
		<!-- /ГЕНЕРАТОР ПОЛКИ -->
	</div>
</body>
</html>